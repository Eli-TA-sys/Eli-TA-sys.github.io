<!DOCTYPE html>
<!-- This file is to display information of our CNC
Created By: Elijsha Baetiong
Last Edited: 3/16/20 -->
<html>
<head>
<title>CnC 1 data</title>
<link rel="stylesheet" href="CSS files/cnc.css"/>
<link rel ="shortcut icon" href="images/icon1.ico"/>
<!--<meta http-equiv="refresh" content="30">-->
</head>
<body bgcolor="white">
<!-- This just creates the header and sets up the adjusted links-->
<div class ="header">
<img src="images/ta.png" alt="TA logo">
<h1>CNC</h1>
<nav>
	<ul>
		<li><a href ="index.php">Home</a></li>
		<li class="current"><a href ="cnc1.php">CNC</a></li>
		<li><a href="cnc2.php">CNC Lathe</a></li>
		<li><a href="LiveGraph.html">Force Gauge</a></li>
	</ul>
</nav>
</div>
<br>
<!--this displays the status of the two CNC's -->

<section class="machineInfo">
<?PHP include 'phpFiles/statusCheck.php'?>
</section>
<!-- Include all the javascript necessary to do the graphs 
also set up the graphs for display-->
<script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
<div class="graphs" style="margin-right:15%;display:inline-block;position:relative;height:10;width:40vw">
<canvas id="avab"></canvas>
</div>
<div class="running" style="display:inline-block;position:relative;height:10;width:40vw">
<canvas id="run" style-"display:center"></canvas>
</div>
<div class="upTime" align="center" style="margin:auto;position:relative; height:10;width:40vw">
<canvas id="Up"></canvas>
</div>
<script type="text/javascript" src="Js_Files/cnc1.js"></script>  
<!-- Create the necessary forms to select information for updates -->
<div align ="center">
<form action="#" method="post">
<select id="time" name="mintues" align="Right">                      
<option value="5">--Select time option--</option>
<option value="1">1</option>
<option value="5">5</option>
<option value="10">10</option>
<option value="15">15</option>
<option value="30">30</option>
<option value="60">60</option>
</select>
Enter date:
<input type="date" name="date">
Enter a time(optional):
<input type="time" name="time">
<input type="submit" name="submit" value="Get Selected Values" />
</form>
</div>
<div class="data">

<?php

/* This takes in the form and crates a query to run to populate the table below the graph*/
    $date="";
    $time="";
    $selected_val = 60;
	if(isset($_POST['submit'])){
	   $selected_val = $_POST['mintues'];
	   $date =$_POST['date'];
	   $time=$_POST['time'];
	}
	if($date==""){
	   $date=date("y/m/d");
	}
    
	$link = mysqli_connect("localhost", "webhost", "pass", "Demo_OEE");
	if ($link){
		if($time=="" and $endTime=="" and $endDate==""){
			$query=mysqli_query($link,"select * from completeData where machineID=1 and extract(minute from timestamp) mod ".$minutes."=0 and timestamp between '".$date." 07:00:00' and now()  limit 50;");
		}		
		else if($time=="" and $endTime==""){
        		$query=mysqli_query($link,"select * from completeData where machineID=1 and extract(mi*nute from timestamp) mod ".$minutes."=0 and timestamp between '".$date." 07:00:00' and '".$endDate." 23:59:59' limit 50;");
		}	
		else if ($endTime=="" and $endDate==""){
        		$query=mysqli_query($link,"select * from completeData where machineID=1 and timestamp between '".$date." ".$time."' and now() and extract(minute from timestamp) mod ".$minutes."=0 limit 50;");
		}		
		else if($endDate==""){	
        		$query=mysqli_query($link,"select * from completeData where machineID=1 and extract(minute from timestamp) mod ".$minutes."=0 and timestamp between '".$date." ".$time."' and '".$date." ".$endTime."' limit 50;");
		}
		else if($endTime==""){
        		$query=mysqli_query($link,"select  * from completeData where machineID=1 and extract(minute from timestamp) mod ".$minutes."=0 and timestamp between '".$date." ".$time."' and '".$endDate." 23:59:59' limit 50;");
}
else{
	$query=mysqli_query($link,"select * from completeData where machineID=1  and extract(minute from timestamp) mod ".$minutes."=0 and timestamp between '".$date." ".$time."' and '".$endDate." ".$endTime."'limit 50;");
} 
    	echo" <table align ='center'>
	<tr bgcolor='#88C6ED'>
	<th>Machine Number</th>
	<th>Time Stamp</th>
	<th>Up time (mins)</th>
	<th>Run time (mins)</th>
	<th>Avalibility per day</th>
	<th>Total tool changes</th>
	<th>Tool in Use</th>
	<th>Total parts run</th>
	<th>Last Cycle Time (seconds)</th>
	<th>Current cycle Time (seconds)</th>
	</tr>	";

	$colors=1;
       while($array = mysqli_fetch_array($query)) {
	  if($colors== 1){
	     echo "<tr bgcolor='#FAA31B'>";
	     $colors=2;
  }
	  else{
	     echo "<tr bgcolor='#EBEBEB'>";
	     $colors=1;
          }
	  echo "<td>".$array['machineID']." </td>";
	  echo "<td>". $array['tStamp']." </td>";
	  echo "<td>". $array['upTime']." </td>";
          echo "<td>". $array['runTime']." </td>";
          echo "<td>". $array['availability']."% </td>";
          echo "<td>". $array['totalToolChange']." </td>";
	  echo "<td>". $array['toolInUse']." </td>";
          echo "<td>". $array['partsRun']." </td>";
	  echo "<td>". $array['lastPartTime']." </td>";
          echo "<td>". $array['recentPartTime']." </td>";

	  echo "</tr>";
		
       }
	echo " </table>";
    }

  else {
       echo "MySQL error :".mysqli_error();
    }
 
?>

</div>
</body>
</html>